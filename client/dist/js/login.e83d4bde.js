(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{5380:function(e,t,a){"use strict";a("f7ce")},"578a":function(e,t,a){"use strict";a.r(t);var o=a("7a23"),r=Object(o["F"])("data-v-e2ce0e16");Object(o["s"])("data-v-e2ce0e16");var s={class:"container"},n={key:0,class:"loader-container"},i=Object(o["g"])("div",{class:"loader"},null,-1),c={class:"loader-text"},l=Object(o["g"])("h2",null,"Formulaire de connexion",-1),u={key:1,class:"error"},d={class:"container"},m={class:"row"},p=Object(o["g"])("div",{class:"col-25"},[Object(o["g"])("label",{for:"username"},"Nom d'utilisateur")],-1),g={class:"col-75"},h={class:"row"},f=Object(o["g"])("div",{class:"col-25"},[Object(o["g"])("label",{for:"password"},"Mot de passe")],-1),b={class:"col-75"},S=Object(o["g"])("div",{class:"row"},[Object(o["g"])("input",{id:"submit",type:"submit",value:"Login"})],-1);Object(o["q"])();var T=r((function(e,t){return Object(o["p"])(),Object(o["d"])("section",s,[e.loader?(Object(o["p"])(),Object(o["d"])("div",n,[i,Object(o["g"])("div",c,Object(o["y"])(e.loaderTxt),1)])):Object(o["e"])("",!0),l,e.error?(Object(o["p"])(),Object(o["d"])("div",u,Object(o["y"])(e.error),1)):Object(o["e"])("",!0),Object(o["g"])("div",d,[Object(o["g"])("form",{onSubmit:t[3]||(t[3]=function(){return e.handleSubmit&&e.handleSubmit.apply(e,arguments)})},[Object(o["g"])("div",m,[p,Object(o["g"])("div",g,[Object(o["E"])(Object(o["g"])("input",{type:"text",id:"username",name:"username","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.username=t})},null,512),[[o["B"],e.username]])])]),Object(o["g"])("div",h,[f,Object(o["g"])("div",b,[Object(o["E"])(Object(o["g"])("input",{type:"password",id:"password",name:"password","onUpdate:modelValue":t[2]||(t[2]=function(t){return e.password=t})},null,512),[[o["B"],e.password]])])]),S],32)])])})),O=a("5530"),v=(a("d3b7"),a("5502")),y=a("9738"),j=a("cf05"),E=a.n(j),P={requestNotifPerm:function(){Notification.requestPermission().then((function(e){console.log("Notifications "+e)}))},showNotif:function(){var e=this;"granted"===Notification.permission?this.showNotif():"denied"!==Notification.permission&&Notification.requestPermission().then((function(t){"granted"===t&&e.createNotif("test","test")}))},createNotif:function(e,t){"granted"===Notification.permission&&new Notification(e,{body:t,icon:E.a})}},I=a("dd76"),N="https://proxy-tps-m1if13-2019.univ-lyon1.fr/123/tp1",w={name:"Login",data:function(){return{username:"",password:"",loader:!1,loaderTxt:"",error:"",gameStatusInterval:null}},computed:Object(O["a"])({},Object(v["d"])({authenticated:"authenticated",gameStatus:"gameStatus",zrr:"zrr",player:"player"})),methods:Object(O["a"])(Object(O["a"])({},Object(v["b"])({setAuthenticated:"SET_AUTHENTICATED",setGameStatus:"SET_GAME_STATUS",setZrr:"SET_ZRR",setPlayerIcon:"SET_PLAYER_ICON",setPlayerId:"SET_PLAYER_ID",setPlayerPos:"SET_PLAYER_POSITION",setPlayerTTL:"SET_PLAYER_TTL",setTTLCreation:"SET_TTL_CREATION",setPlayers:"SET_PLAYERS",setMeteorites:"SET_METEORITES",setCurrentLat:"SET_CURRENT_LAT",setCurrentLng:"SET_CURRENT_LNG",setPlayerTrophy:"SET_PLAYER_TROPHY"})),{},{handleSubmit:function(e){var t=this;e.preventDefault(),""===this.username&&""===this.password?this.error="Nom d'utilisateur et/ou mot de passe ne doivent pas être vides !":I["a"].getPlayerById("test").then((function(){t.logPlayer()})).catch((function(e){console.log(e),t.error="Vous ne pouvez pas rejoindre le jeu !"}))},logPlayer:function(){var e=this;this.loaderTxt="En attente de la connexion du joueur...",this.loader=!0;var t={login:this.username,password:this.password},a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};fetch(N+"/login",a).then((function(t){if(204!==t.status)throw e.loader=!1,new Error;e.loader=!1,localStorage.setItem("token",t.headers.get("Authorization")),e.setAuthenticated(!0),e.setData(t)})).then((function(){e.setPos(),P.requestNotifPerm()})).catch((function(t){console.log(t),e.error="Nom d'utilisateur et/ou mot de passe non valides !",localStorage.removeItem("token")}))},setData:function(){this.setGameStatus(),this.setZrr(),this.setPlayerId(this.username),this.setPlayerTTL(this.username),this.setTTLCreation(Date.now()),this.setPlayerIcon(this.username),this.setPlayerTrophy(this.username),this.setPlayers(),this.setMeteorites()},setPos:function(){var e=this;this.loaderTxt="En attente de la position du joueur...",this.loader=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){e.setPlayerPos([t.coords.latitude,t.coords.longitude]),e.setCurrentLat(t.coords.latitude),e.setCurrentLng(t.coords.longitude),e.waitGameStart()}),(function(t){y["a"].handleError(t),e.loader=!1}),y["a"].options):(this.loader=!1,alert("La géolocalisation n'est pas supportée par le navigateur."))},waitGameStart:function(){var e=this;this.loaderTxt="En attente du début de la partie...",this.gameStatusInterval=setInterval((function(){e.setGameStatus(),!0===e.gameStatus&&(console.log("STOP"),clearInterval(e.gameStatusInterval),e.setStorage())}),1e3)},setStorage:function(){var e=this;setTimeout((function(){e.loader=!1,localStorage.setItem("gameStatus",e.gameStatus),localStorage.setItem("playerId",e.player.id),localStorage.setItem("zrr",JSON.stringify(e.zrr)),localStorage.setItem("playerIcon",e.player.icon),localStorage.setItem("playerPos",JSON.stringify(e.player.position)),localStorage.setItem("timestampTTL",JSON.stringify(e.player.ttl_creation_timestamp)),P.createNotif("Solid Rain","La partie a commencé ! "),e.$router.push({name:"Map"})}),1e3)}}),created:function(){},beforeUnmount:function(){clearInterval(this.gameStatusInterval)}};a("5380");w.render=T,w.__scopeId="data-v-e2ce0e16";t["default"]=w},9738:function(e,t,a){"use strict";t["a"]={handleError:function(e){var t=e.code,a=null;switch(t){case e.TIMEOUT:a="The request to get user location timed out.";break;case e.PERMISSION_DENIED:a="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:a="Location information is unavailable.";break}alert(a)},options:{enableHighAccuracy:!0,timeout:1e4,maximumAge:0},stopWatchCurrentPos:function(e){navigator.geolocation.clearWatch(e)}}},f7ce:function(e,t,a){}}]);
//# sourceMappingURL=login.e83d4bde.js.map